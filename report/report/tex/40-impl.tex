\chapter{Технологический раздел}
\label{cha:impl}

В данном разделе описаны требуемые средства и подходы к реализации ПО по ранее указанным методам.

% самые важные листинги
% технологические куски
% изящные вещи
% выбор средств реализации: ЯП, ОС, библиотеки
% readme, инструкции запуска-удаления и т.п.

\section{Требования к программному обеспечению}

Разработанное ПО должно моделировать движение воды с использованием вокселов.
%
% Пользователь должен иметь возможность изменять степень детализации,
% источники освещения, выбирать вид отображения воды:
% \begin{itemize}
%     \item волны;
%     \item спокойное течение.
% \end{itemize}

Моделирование движения должно осуществляться с использованием операций переноса, масштабирования и поворота.

\section{Используемые технологии}

Для реализации ПО выбран язык Clojure. Данный язык программирования является
компилируемым и, одновременно с этим, динамическим. Clojure - преимущественно
язык функционального программирования, который поддерживает нативный доступ к
Java фреймворкам \cite{site:clojure}.

Данные свойства языка позволяют вести разработку приложений с помощью REPL
(Read-Eval-Print Loop), модифицируя их во время выполнения. Это может быть
полезно для добавления новых функциональностей в программу без её повторной сборки
\cite{site:repl}.
%cite

Для создания пользовательского интерфейса используется Java библиотека Swing.
Swing предоставляет широкий набор компонентов для создания графического пользовательского
интерфейса. Данные компоненты полностью реализованы на Java, поэтому их внешний вид не зависит
от платформы.

Для организации проекта на Clojure и для автоматизации сборки используется Leiningen.
Все конфигурации для сборки приложения, запуска REPL и описания зависимостей управляются с помощью
этого модуля\cite{site:lein}.

\section{Листинги кода}

В листинге \ref{lst:config} указана конфигурация сборки проекта на языке Clojure.

\begin{lstlisting}[
                basicstyle={\fontsize{9}{10}\ttfamily},
                mathescape=true,
                showstringspaces=false,
                tabsize=2,
                flexiblecolumns=true,
                language={Clojure},
                label={lst:config}
            ]
(defproject computer-graphics-coursework-backend "0.1.0-SNAPSHOT"
  :description "Pudov's computer graphics coursework"
  :url "https://github.com/DPudov"
  :license {:name "Eclipse Public License"
            :url  "http://www.eclipse.org/legal/epl-v10.html"}
  :dependencies [[org.clojure/clojure "1.10.0"]
                 [seesaw "1.5.0"]]
  :repl-options {:init-ns computer_graphics_coursework_backend.core}
  :main computer_graphics_coursework_backend.core
  :profiles {:uberjar {:aot :all}}
  :java-cmd "/usr/lib/jvm/java-1.11.0-openjdk-amd64/bin/java")
\end{lstlisting}

В листинге \ref{lst:lambert} описана реализация получения цвета по Ламберту.

\begin{lstlisting}[
                basicstyle={\fontsize{9}{10}\ttfamily},
                mathescape=true,
                showstringspaces=false,
                tabsize=2,
                flexiblecolumns=true,
                language={Clojure},
                label={lst:lambert}
            ]
(defn colorize [v1]
  (let [v1-xyz (:position v1)
        c (:color v1)
        r (.getRed c)
        g (.getGreen c)
        b (.getBlue c)
        v1-normal (vec/normalize (voxel/voxel-normal (:normal v1)))
        light-direction-v1 (vec/normalize (vec/sub @lights/light v1-xyz))
        view-direction-v1 (vec/normalize (vec/sub v1-xyz))
        reflect-v1 (vec/reflect (vec/sub light-direction-v1) v1-normal)
        diffuse-v1 (vec/scale lights/diffuse-albedo (max (vec/dot v1-normal light-direction-v1) 0.0))
        specular-v1 (vec/scale lights/specular-albedo (Math/pow (max (vec/dot reflect-v1 view-direction-v1) 0.0) lights/specular-power))
        modification (vec/add lights/ambient diffuse-v1 specular-v1)]

    (+ (bit-shift-left (int (* 255 (modification 3))) 24)
       (bit-shift-left (int (* r (modification 0))) 16)
       (bit-shift-left (int (* g (modification 1))) 8)
       (int (* b (modification 2))))))
\end{lstlisting}


% вывод по разделу
\section{Вывод}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "rpz"
%%% End:
